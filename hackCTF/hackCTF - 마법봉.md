# HackCTF - 마법봉

---



![image](https://user-images.githubusercontent.com/33051018/69029516-867c3000-0a18-11ea-81f5-c364475d007a.png)

HackCTF의 **마법봉**문제이다.

바로 문제를 풀어보도록 하자.



### 문제풀이

---

>![image](https://user-images.githubusercontent.com/33051018/69029550-a4499500-0a18-11ea-95cd-22bf03da6ed5.png)
>
>문제 설명에 기재되어진 URL을 타고 들어가면 위와 같은 웹 페이지를 확인할 수 있다.
>
>**해쉬에 마법을 부여하면 그 어떤것도 뚫린다고 한다..?**
>
>**View Source** 버튼을 클릭해 코드를 살펴보자.
>
>![image](https://user-images.githubusercontent.com/33051018/69029635-e4107c80-0a18-11ea-8aeb-bfcad7311905.png)
>
>`md5(240610708)` 값 과 `sha1($input)`값을 `==`연산자를 통해 비교하여 동일할 경우 플래그를 출력해준다.
>
>해당 문제는 `Magic Hash`에 대해 알고있는지 묻는 문제이다.
>
>우선 `md5(240610708)` 값을 확인하도록 한다.
>
>md5(240610708)의 결과는 `0e462097431906509019562988736854`이다.
>
>해당 결과값만 구글에 검색하여도 Magic Hash에 대한 정보를 알 수 있다.
>
>**Magic Hash**란, PHP에서 `==`를 통해 비교시 생기는 `type conversion`에 의한 취약점이다.
>
>[magic Hash](https://www.whitehatsec.com/blog/magic-hashes/) 링크를 참고하도록 하자.
>
>이를 통해, 결과값과 같은  `sha1` hash를 알 수 있으며 이를 제출하면 `flag`를 확인할 수 있다.



### 배운점

---

>#### PHP - Magic hash Vulnerability
>
>
>
>```php
><?php
>    var_dump(md5('240610708') == md5('QNKCDZO'));
>?>
>```
>
>**240610708** 과 **QNKCDZO**는 엄연히 다른값이다.
>
>따라서, 이를 바탕으로 얻어낸  Hash Value 또한 엄연히 다른것이 맞다.
>
>240610708의 MD5 해쉬값은 `0E462097431906509019562988736854` 이다.
>
>QNKCDZO의 MD5 해쉬값은 `0E830400451993494058024219903391`이다.
>
>두 해쉬값은 엄연히 다르나 공통점으로는 `0e`로 값이 시작되며 뒤가 모두 숫자라는 점이다.
>
>두 값 모두 `string` 타입 이지만, 비교(==)연산시에는 `float`으로 `Type Casting`이 되기 때문에 문제가 발생한다. `php`내에서 ==연산은 자료형에 상관없이 값만 비교하기 때문에, 이 두 값은 모두 `exponent`로 바뀌어 0이라는 값을 갖게되어 비교결과가 참이된다.
>
>`php`에서 ==는 자료형의 상관없이 값만 비교하기 때문에 다소 취약할 수 있다.
>
>사용시에는 주의를 기울여야 하며, 되도록 ===연산자(자료형 + 값 비교)를 사용하는것을 권장한다.





